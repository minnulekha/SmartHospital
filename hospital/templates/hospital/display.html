<!DOCTYPE html>
<html>
<head>
    <title>Hospital Waiting Display</title>
    <meta http-equiv="refresh" content="10"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #121212; color: white; font-family: 'Segoe UI', sans-serif; }
        
        /* THEME ENGINE (CSS) */
        /* Default Styles */
        .doctor-card { background: #1e1e1e; border-top: 5px solid #6c757d; border-radius: 15px; height: 100%; transition: transform 0.2s; }
        .token-box { background: #333; color: white; border-radius: 10px; padding: 15px; }
        .dept-badge { font-size: 0.8rem; text-transform: uppercase; padding: 5px 12px; border-radius: 20px; letter-spacing: 1px; font-weight: bold; }

        /* 1. Cardiology (Red) */
        .doctor-card[data-dept*="Cardio"] { border-top-color: #ef5350; }
        .doctor-card[data-dept*="Cardio"] .token-box { background: #c62828; }
        .doctor-card[data-dept*="Cardio"] .dept-badge { background: #ef5350; color: white; }

        /* 2. Neurology (Purple) */
        .doctor-card[data-dept*="Neuro"] { border-top-color: #ab47bc; }
        .doctor-card[data-dept*="Neuro"] .token-box { background: #7b1fa2; }
        .doctor-card[data-dept*="Neuro"] .dept-badge { background: #ab47bc; color: white; }

        /* 3. ENT (Orange) */
        .doctor-card[data-dept*="ENT"] { border-top-color: #ffa726; }
        .doctor-card[data-dept*="ENT"] .token-box { background: #f57c00; }
        .doctor-card[data-dept*="ENT"] .dept-badge { background: #ffa726; color: white; }

        /* 4. Dermatology (Pink) */
        .doctor-card[data-dept*="Derma"] { border-top-color: #ec407a; }
        .doctor-card[data-dept*="Derma"] .token-box { background: #c2185b; }
        .doctor-card[data-dept*="Derma"] .dept-badge { background: #ec407a; color: white; }

        /* 5. General Medicine (Green) */
        .doctor-card[data-dept*="General"] { border-top-color: #66bb6a; }
        .doctor-card[data-dept*="General"] .token-box { background: #388e3c; }
        .doctor-card[data-dept*="General"] .dept-badge { background: #66bb6a; color: white; }

        /* 6. Urology (Blue) */
        .doctor-card[data-dept*="Uro"] { border-top-color: #42a5f5; }
        .doctor-card[data-dept*="Uro"] .token-box { background: #1976d2; }
        .doctor-card[data-dept*="Uro"] .dept-badge { background: #42a5f5; color: white; }

        /* Typography */
        .display-token { font-size: 5rem; font-weight: 700; line-height: 1; }
        
        /* Animation */
        .blink { animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

    <div class="container-fluid py-4">
        
        <div class="d-flex justify-content-between align-items-center mb-5 border-bottom border-secondary pb-3">
            <div>
                <h1 class="fw-bold mb-0">üè• LIVE QUEUE STATUS</h1>
                <p class="text-muted mb-0">Real-time updates from all departments</p>
            </div>
            <div class="text-end">
                <h3 id="clock" class="fw-bold">--:--</h3>
                <small class="text-muted" id="date">Loading...</small>
            </div>
        </div>

        <div class="row g-4">
            {% for item in doctors %}
            <div class="col-md-4 col-lg-3">
                <div class="doctor-card shadow p-3" data-dept="{{ item.dept }}">
                    
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h5 class="fw-bold mb-1">
                                Dr. {% if item.doctor.user.first_name %}{{ item.doctor.user.first_name }}{% else %}{{ item.doctor.user.username }}{% endif %}
                            </h5>
                            <span class="dept-badge">{{ item.dept }}</span>
                        </div>
                        {% if item.current_token != "--" %}
                            <i class="fas fa-circle text-danger blink small"></i>
                        {% else %}
                            <i class="fas fa-circle text-muted small"></i>
                        {% endif %}
                    </div>

                    <div class="token-box text-center mb-3 shadow-sm">
                        <small class="d-block text-white-50 text-uppercase" style="font-size: 0.7rem;">Now Serving</small>
                        <div class="display-token">{{ item.current_token }}</div>
                        <div class="fw-bold text-truncate mt-1">{{ item.current_name }}</div>
                    </div>

                    <div class="bg-dark rounded p-2 border border-secondary">
                        <small class="text-muted text-uppercase ms-1" style="font-size: 0.65rem;">Up Next</small>
                        <ul class="list-unstyled mb-0 mt-2">
                            {% for next_p in item.waiting %}
                            <li class="d-flex justify-content-between px-2 py-1 border-bottom border-secondary" style="font-size: 0.85rem;">
                                <span class="text-white fw-bold">#{{ next_p.token_number }}</span>
                                <span class="text-muted text-truncate" style="max-width: 110px;">{{ next_p.patient_name }}</span>
                            </li>
                            {% empty %}
                            <li class="text-center text-muted small py-2 italic">Queue Empty</li>
                            {% endfor %}
                        </ul>
                    </div>

                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <i class="fas fa-user-slash fa-4x text-muted mb-3"></i>
                <h3 class="text-muted">ALL DOCTORS ARE CURRENTLY OFFLINE</h3>
                <p class="text-white-50">Please check the reception desk for more information.</p>
            </div>
            {% endfor %}
        </div>
    </div>

<script>
    function updateTime() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        document.getElementById('date').innerText = now.toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' });
    }
    setInterval(updateTime, 1000);
    updateTime();
</script>

</body>
</html>